# K8s节点诊断工具实现计划

## 核心任务

### 1. 项目初始化
- [x] 1.1 创建项目目录结构
```bash
mkdir -p cmd internal/collector internal/processor internal/config pkg/report test
```
- [x] 1.2 初始化Go模块
```bash
go mod init github.com/miaoyq/node-diagnostor
```

### 2. 配置管理模块
- [x] 2.1 实现配置加载器
  - 使用fsnotify监听配置文件变化
  - 支持1秒内热加载配置
  - _需求：4.1, 4.3_
- [x] 2.2 设计配置结构
  - 支持动态检查项参数
  - 支持journald单元配置
  - _需求：2.1, 4.2_

### 3. 数据采集模块
- [x] 3.1 实现指标采集器
  - 支持CPU/内存/磁盘/网络指标采集
  - 支持动态采集周期
  - _需求：2.1_
- [x] 3.2 实现日志监视器
  - 基于journalctl命令采集日志
  - 支持按单元过滤(kubelet, containerd)
  - _需求：2.2, 2.3_
- [x] 3.3 实现诊断检查器
  - 内核参数检查
  - 进程状态检查(D状态进程)
  - 文件描述符检查
  - _需求：补充要求4_

### 4. 数据处理与上报
- [x] 4.1 实现数据处理器
  - 聚合采集数据
  - 生成JSON格式报告
  - 本地缓存管理(TTL可配置)
  - _需求：3.1, 3.3_
- [x] 4.2 实现上报客户端
  - 异步HTTP上报
  - 失败重试机制(指数退避)
  - _需求：3.2, 3.3_

### 5. 测试与验证
- [x] 5.1 编写单元测试
  - 配置热加载逻辑测试
  - 指标采集准确性测试
  - _需求：测试策略1_
- [x] 5.2 集成测试
  - 全流程数据采集处理上报测试
  - 资源限制场景测试
  - _需求：测试策略2_